"use strict";(()=>{var e={};e.id=280,e.ids=[280],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8063:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>y,originalPathname:()=>w,requestAsyncStorage:()=>d,routeModule:()=>u,serverHooks:()=>h,staticGenerationAsyncStorage:()=>p,staticGenerationBailout:()=>m});var o={};r.r(o),r.d(o,{POST:()=>POST}),r(8976);var i=r(884),a=r(6132),s=r(5798);let n=[{title:"霸道总裁的契约娇妻",author:"佚名",description:"一个普通女孩因为家族债务被迫嫁给霸道总裁，两人从互相看不顺眼到慢慢相爱，最终收获真爱。这是一个先婚后爱的甜蜜故事。"},{title:"校园青春恋歌",author:"青春作家",description:"高中校园里，学霸女主和校草男主的青春恋爱故事。从同桌到恋人，经历了高考、分离、重逢，最终在大学里重逢并相爱。"},{title:"暗恋十年终成眷属",author:"暗恋专家",description:"女主暗恋男主十年，从高中到大学再到工作，默默守护着这份感情。男主终于发现女主的真心，两人开始了一段甜蜜的恋爱。"},{title:"重生之都市修仙",author:"修仙大神",description:"主角重生回到十年前，带着前世的记忆和修仙功法，在都市中崛起。通过修仙改变命运，同时收获了真挚的爱情。"},{title:"古代宫廷权谋",author:"古言大师",description:"古代宫廷中，女主从一个普通宫女成长为权倾朝野的皇后。在复杂的宫廷斗争中，她不仅要保护自己，还要守护心爱的人。"},{title:"职场女强人的爱情",author:"都市作家",description:"现代都市中，一个事业有成的女强人遇到了一个温柔体贴的男人。在职场和爱情之间，她学会了平衡，最终收获了事业和爱情的双丰收。"},{title:"救赎之恋",author:"治愈系作家",description:"男主因为过去的创伤而封闭内心，女主用温暖和爱意慢慢治愈他。这是一个关于救赎、治愈和重生的感人故事。"},{title:"豪门世家的联姻",author:"豪门专家",description:"两个豪门世家为了商业利益而联姻，男女主从互相排斥到慢慢了解，最终在豪门斗争中携手共进，收获了真挚的爱情。"}];async function searchNovelsWithMock(e){let t=n.map(t=>({...t,matchScore:function(e,t){let r=e.toLowerCase().split(/\s+/),o=t.toLowerCase(),i=0;return r.forEach(e=>{o.includes(e)&&i++}),i}(e,t.description)})).filter(e=>e.matchScore>0).sort((e,t)=>t.matchScore-e.matchScore).slice(0,5);return t.map(e=>({title:e.title,author:e.author,description:e.description,category:"其他",searchDate:new Date().toLocaleString("zh-CN")}))}async function searchNovels(e){try{return await searchNovelsWithMock(e)}catch(e){return console.error("搜索失败，使用备用方案:",e),[]}}var c=r(148);let l=[{name:"暗恋文",description:"主角暗恋他人，情感细腻，内心戏丰富",keywords:["暗恋","单恋","默默喜欢","不敢表白","偷偷关注","内心戏","暗恋多年","默默守护"]},{name:"救赎文",description:"主角通过爱情或经历得到救赎，治愈系",keywords:["救赎","治愈","重生","改变","救赎","新生","重生","救赎","治愈系","改变命运"]},{name:"豪门文",description:"涉及豪门世家，商业联姻，权谋",keywords:["豪门","世家","总裁","商业","联姻","权谋","继承","豪门世家","商业帝国","总裁文"]},{name:"先婚后爱文",description:"先结婚后恋爱，契约婚姻",keywords:["先婚后爱","契约婚姻","闪婚","假结婚","婚后恋爱","契约夫妻","闪婚","假结婚"]},{name:"校园文",description:"发生在校园的青春故事",keywords:["校园","学生","青春","学校","同学","老师","高考","大学","高中","校园生活"]},{name:"都市文",description:"现代都市生活，职场情感",keywords:["都市","职场","白领","办公室","现代","都市生活","职场","白领","都市情感"]},{name:"古言文",description:"古代背景，宫廷或江湖",keywords:["古代","宫廷","江湖","王爷","公主","皇帝","古代背景","宫廷","江湖","古代言情"]},{name:"现言文",description:"现代言情，非校园非职场",keywords:["现代","言情","恋爱","现代背景","现代言情","都市言情"]}];async function classifyNovelWithAI(e){let t=process.env.GOOGLE_API_KEY;if(!t)return classifyNovelWithKeywords(e);try{let r=new c.$D(t),o=r.getGenerativeModel({model:"gemini-pro"}),i=l.map(e=>e.name).join("、"),a=`你是一个小说分类专家。请根据小说简介将其分类为以下类别之一：${i}。

分类标准：
- 暗恋文：主角暗恋他人，情感细腻，内心戏丰富
- 救赎文：主角通过爱情或经历得到救赎，治愈系
- 豪门文：涉及豪门世家，商业联姻，权谋
- 先婚后爱文：先结婚后恋爱，契约婚姻
- 校园文：发生在校园的青春故事
- 都市文：现代都市生活，职场情感
- 古言文：古代背景，宫廷或江湖
- 现言文：现代言情，非校园非职场
- 其他：不属于以上分类的小说

请只返回分类名称，不要包含其他内容。

小说简介：${e}`,s=await o.generateContent(a),n=await s.response,u=n.text().trim();if(u&&l.some(e=>e.name===u))return u;return"其他"}catch(t){return console.error("Gemini分类错误:",t),classifyNovelWithKeywords(e)}}function classifyNovelWithKeywords(e){let t=e.toLowerCase(),r=l.map(e=>{let r=e.keywords.filter(e=>t.includes(e.toLowerCase())).length;return{category:e.name,score:r}}),o=r.reduce((e,t)=>t.score>e.score?t:e);return o.score>0?o.category:"其他"}async function classifyNovel(e){try{return await classifyNovelWithAI(e)}catch(t){return classifyNovelWithKeywords(e)}}async function POST(e){try{let{query:t}=await e.json();if(!t)return s.Z.json({error:"搜索关键词不能为空"},{status:400});let r=await searchNovels(t),o=await Promise.all(r.map(async e=>{let t=await classifyNovel(e.description);return{title:e.title,author:e.author,description:e.description,category:t,searchDate:new Date().toLocaleString("zh-CN")}}));return s.Z.json({novels:o})}catch(e){return console.error("搜索错误:",e),s.Z.json({error:"搜索失败，请稍后重试"},{status:500})}}let u=new i.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/search/route",pathname:"/api/search",filename:"route",bundlePath:"app/api/search/route"},resolvedPagePath:"D:\\cursor vip for free\\test01\\app\\api\\search\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:d,staticGenerationAsyncStorage:p,serverHooks:h,headerHooks:y,staticGenerationBailout:m}=u,w="/api/search/route"}};var t=require("../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[955,148],()=>__webpack_exec__(8063));module.exports=r})();