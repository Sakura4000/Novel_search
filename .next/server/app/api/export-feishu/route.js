"use strict";(()=>{var e={};e.id=970,e.ids=[970],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},1049:(e,t,o)=>{o.r(t),o.d(t,{headerHooks:()=>f,originalPathname:()=>m,requestAsyncStorage:()=>h,routeModule:()=>p,serverHooks:()=>l,staticGenerationAsyncStorage:()=>d,staticGenerationBailout:()=>_});var r={};o.r(r),o.d(r,{GET:()=>GET,POST:()=>POST}),o(8976);var n=o(884),a=o(6132),s=o(5798);let i=process.env.FEISHU_APP_ID,c=process.env.FEISHU_APP_SECRET,u=process.env.FEISHU_FOLDER_TOKEN;async function getFeishuAccessToken(){try{let e=await fetch("https://open.feishu.cn/open-apis/auth/v3/tenant_access_token/internal",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({app_id:i,app_secret:c})}),t=await e.json();if(0!==t.code)throw Error(`èŽ·å–è®¿é—®ä»¤ç‰Œå¤±è´¥: ${t.msg}`);return t.tenant_access_token}catch(e){throw console.error("èŽ·å–é£žä¹¦è®¿é—®ä»¤ç‰Œé”™è¯¯:",e),e}}async function createFeishuDocument(e,t){try{let o=await fetch("https://open.feishu.cn/open-apis/docx/v1/documents",{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({folder_token:u,title:t})}),r=await o.json();if(0!==r.code)throw Error(`åˆ›å»ºæ–‡æ¡£å¤±è´¥: ${r.msg}`);return r.data.document.document_id}catch(e){throw console.error("åˆ›å»ºé£žä¹¦æ–‡æ¡£é”™è¯¯:",e),e}}async function updateDocumentContent(e,t,o){try{let r=await fetch(`https://open.feishu.cn/open-apis/docx/v1/documents/${t}/blocks`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({requests:[{insert_block:{location:{index:0},block:{type:"text",text:{content:o}}}}]})}),n=await r.json();if(0!==n.code)throw Error(`æ›´æ–°æ–‡æ¡£å†…å®¹å¤±è´¥: ${n.msg}`)}catch(e){throw console.error("æ›´æ–°æ–‡æ¡£å†…å®¹é”™è¯¯:",e),e}}async function POST(e){try{if(!i||!c||!u)return s.Z.json({error:"é£žä¹¦APIé…ç½®ä¸å®Œæ•´ï¼Œè¯·æ£€æŸ¥çŽ¯å¢ƒå˜é‡"},{status:500});let{novels:t}=await e.json();if(!t||!Array.isArray(t)||0===t.length)return s.Z.json({error:"æ²¡æœ‰å¯å¯¼å‡ºçš„æ”¶è—æ•°æ®"},{status:400});let o=await getFeishuAccessToken(),r=`å°è¯´æ”¶è—_${new Date().toLocaleDateString("zh-CN")}`,n=function(e){let t=function(e){let t={};return e.forEach(e=>{let o=e.category||"å…¶ä»–";t[o]||(t[o]=[]),t[o].push(e)}),t}(e),o=e.length,r=`# ðŸ“š æˆ‘çš„å°è¯´æ”¶è—

`;return r+=`**å¯¼å‡ºæ—¶é—´**: ${new Date().toLocaleString("zh-CN")}
**æ€»æ”¶è—æ•°**: ${o} æœ¬

`,Object.entries(t).forEach(([e,t])=>{r+=`## ${e} (${t.length}æœ¬)

`,t.forEach((e,t)=>{r+=`### ${t+1}. ${e.title}

**ä½œè€…**: ${e.author}

**ç®€ä»‹**: ${e.description}

**ä¿å­˜æ—¶é—´**: ${e.searchDate}

---

`})}),r}(t),a=await createFeishuDocument(o,r);return await updateDocumentContent(o,a,n),s.Z.json({success:!0,message:"æˆåŠŸå¯¼å‡ºåˆ°é£žä¹¦æ–‡æ¡£",documentId:a,title:r,count:t.length})}catch(e){return console.error("é£žä¹¦å¯¼å‡ºé”™è¯¯:",e),s.Z.json({error:"å¯¼å‡ºå¤±è´¥ï¼Œè¯·ç¨åŽé‡è¯•"},{status:500})}}async function GET(){return s.Z.json({status:"ok",message:"é£žä¹¦å¯¼å‡ºAPIæ­£å¸¸è¿è¡Œ",config:{hasAppId:!!i,hasAppSecret:!!c,hasFolderToken:!!u}})}let p=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/export-feishu/route",pathname:"/api/export-feishu",filename:"route",bundlePath:"app/api/export-feishu/route"},resolvedPagePath:"D:\\cursor vip for free\\test01\\app\\api\\export-feishu\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:h,staticGenerationAsyncStorage:d,serverHooks:l,headerHooks:f,staticGenerationBailout:_}=p,m="/api/export-feishu/route"}};var t=require("../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),o=t.X(0,[955],()=>__webpack_exec__(1049));module.exports=o})();